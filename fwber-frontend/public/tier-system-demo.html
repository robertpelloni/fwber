<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>FWBer Tier System Interactive Demo</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 0; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .header { text-align: center; color: white; margin-bottom: 32px; }
    .header h1 { font-size: 42px; margin: 0 0 8px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .header p { font-size: 18px; opacity: 0.9; margin: 0; }
    
    .auth-panel { 
      background: white; border-radius: 16px; padding: 24px; margin-bottom: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .auth-row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    input { padding: 12px 16px; font-size: 14px; border: 2px solid #e1e4e8; border-radius: 8px; }
    input:focus { outline: none; border-color: #667eea; }
    button {
      padding: 12px 20px; font-size: 14px; font-weight: 600; cursor: pointer;
      border: none; border-radius: 8px; transition: all 0.2s;
    }
    button.primary { background: #667eea; color: white; }
    button.primary:hover { background: #5568d3; transform: translateY(-1px); }
    button.secondary { background: #f6f8fa; color: #24292e; }
    button.secondary:hover { background: #e1e4e8; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .status { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .status.logged-out { background: #ffeef0; color: #d73a49; }
    .status.logged-in { background: #dcffe4; color: #22863a; }
    
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    
    .card {
      background: white; border-radius: 16px; padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .card h2 { margin: 0 0 16px; font-size: 24px; color: #24292e; }
    .card h3 { margin: 16px 0 12px; font-size: 18px; color: #586069; }
    
    .tier-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: 20px; font-weight: 600;
      font-size: 16px; margin-bottom: 16px;
    }
    .tier-badge.discovery { background: #ffeaa7; color: #d63031; }
    .tier-badge.matched { background: #74b9ff; color: #0984e3; }
    .tier-badge.chatting { background: #a29bfe; color: #6c5ce7; }
    .tier-badge.dating { background: #fd79a8; color: #e84393; }
    .tier-badge.relationship { background: #55efc4; color: #00b894; }
    
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
    .stat {
      padding: 12px; background: #f6f8fa; border-radius: 8px; text-align: center;
    }
    .stat-value { font-size: 24px; font-weight: 700; color: #667eea; }
    .stat-label { font-size: 12px; color: #586069; margin-top: 4px; }
    
    .photo-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 12px; margin: 16px 0;
    }
    .photo-card {
      aspect-ratio: 1; background: #f6f8fa; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 32px; border: 2px solid #e1e4e8;
      position: relative; overflow: hidden;
    }
    .photo-card.ai { border-color: #667eea; background: linear-gradient(135deg, #667eea22, #764ba222); }
    .photo-card.real { border-color: #22863a; background: linear-gradient(135deg, #22863a22, #00b89422); }
    .photo-card.locked {
      background: #fafbfc; border-color: #d1d5da; filter: grayscale(1);
      opacity: 0.5;
    }
    .photo-badge {
      position: absolute; top: 4px; right: 4px;
      background: white; padding: 2px 6px; border-radius: 4px;
      font-size: 10px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .photo-badge.ai { color: #667eea; }
    .photo-badge.real { color: #22863a; }
    
    .unlock-list {
      list-style: none; padding: 0; margin: 12px 0;
    }
    .unlock-list li {
      padding: 8px 12px; margin: 4px 0; background: #f6f8fa;
      border-radius: 8px; display: flex; align-items: center; gap: 8px;
    }
    .unlock-list li::before { content: '‚úì'; color: #22863a; font-weight: 700; }
    
    .log {
      background: #24292e; color: #f6f8fa; padding: 16px;
      border-radius: 8px; font-family: 'Courier New', monospace;
      font-size: 12px; max-height: 300px; overflow-y: auto;
      margin-top: 16px;
    }
    .log-line { margin: 4px 0; }
    .log-line.success { color: #34d399; }
    .log-line.error { color: #f87171; }
    .log-line.info { color: #60a5fa; }
    
    .loading { 
      display: inline-block; width: 16px; height: 16px;
      border: 2px solid #667eea; border-top-color: transparent;
      border-radius: 50%; animation: spin 0.6s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üí´ FWBer Tier System</h1>
      <p>Interactive Relationship Progression Demo</p>
    </div>

    <div class="auth-panel">
      <div class="auth-row">
        <input id="email" type="email" value="alice@test.com" placeholder="Email" />
        <input id="password" type="password" value="password123" placeholder="Password" />
        <button class="primary" onclick="login()" id="loginBtn">Login as Alice</button>
        <button class="secondary" onclick="switchUser()" id="switchBtn">Switch to Bob</button>
        <button class="secondary" onclick="logout()" id="logoutBtn" disabled>Logout</button>
        <span id="authStatus" class="status logged-out">Not Logged In</span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>üéØ Current Tier Status</h2>
        <div id="tierInfo">
          <p style="color: #586069;">Login to view tier information</p>
        </div>
        
        <h3>üìä Relationship Metrics</h3>
        <div class="stat-grid" id="metrics">
          <div class="stat">
            <div class="stat-value">--</div>
            <div class="stat-label">Messages</div>
          </div>
          <div class="stat">
            <div class="stat-value">--</div>
            <div class="stat-label">Days</div>
          </div>
          <div class="stat">
            <div class="stat-value">--</div>
            <div class="stat-label">Met IRL</div>
          </div>
        </div>
        
        <h3>üîì Unlocked Features</h3>
        <ul class="unlock-list" id="unlocks">
          <li style="opacity: 0.5;">Login to see unlocks</li>
        </ul>
      </div>

      <div class="card">
        <h2>üñºÔ∏è Photo Gallery</h2>
        <h3>ü§ñ AI-Generated Photos (Always Visible)</h3>
        <div class="photo-grid" id="aiPhotos">
          <div class="photo-card ai locked">
            <span>üé®</span>
            <span class="photo-badge ai">AI</span>
          </div>
          <div class="photo-card ai locked">
            <span>üé®</span>
            <span class="photo-badge ai">AI</span>
          </div>
        </div>
        
        <h3>üì∏ Real Photos (Unlocked by Tier)</h3>
        <div class="photo-grid" id="realPhotos">
          <div class="photo-card real locked">
            <span>üîí</span>
            <span class="photo-badge real">Real</span>
          </div>
          <div class="photo-card real locked">
            <span>üîí</span>
            <span class="photo-badge real">Real</span>
          </div>
          <div class="photo-card real locked">
            <span>üîí</span>
            <span class="photo-badge real">Real</span>
          </div>
          <div class="photo-card real locked">
            <span>üîí</span>
            <span class="photo-badge real">Real</span>
          </div>
          <div class="photo-card real locked">
            <span>üîí</span>
            <span class="photo-badge real">Real</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top: 24px;">
      <h2>üì° API Activity Log</h2>
      <div class="log" id="log"></div>
    </div>
  </div>

  <script>
    const API = 'http://localhost:8010/api';
    let token = null;
    let currentUser = 'alice';

    function log(msg, type = 'info') {
      const el = document.getElementById('log');
      const line = document.createElement('div');
      line.className = `log-line ${type}`;
      const time = new Date().toLocaleTimeString();
      line.textContent = `[${time}] ${msg}`;
      el.appendChild(line);
      el.scrollTop = el.scrollHeight;
    }

    function updateAuthUI() {
      const status = document.getElementById('authStatus');
      const logoutBtn = document.getElementById('logoutBtn');
      const loginBtn = document.getElementById('loginBtn');
      
      if (token) {
        status.textContent = `Logged in as ${currentUser === 'alice' ? 'Alice' : 'Bob'}`;
        status.className = 'status logged-in';
        logoutBtn.disabled = false;
        loginBtn.disabled = true;
      } else {
        status.textContent = 'Not Logged In';
        status.className = 'status logged-out';
        logoutBtn.disabled = true;
        loginBtn.disabled = false;
      }
    }

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      log(`Logging in as ${email}...`);
      
      try {
        const res = await fetch(`${API}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await res.json();
        
        if (res.ok) {
          token = data.token;
          log(`‚úì Login successful! Token: ${token.slice(0, 16)}...`, 'success');
          updateAuthUI();
          await loadTierData();
        } else {
          log(`‚úó Login failed: ${data.message}`, 'error');
        }
      } catch (e) {
        log(`‚úó Error: ${e.message}`, 'error');
      }
    }

    function switchUser() {
      currentUser = currentUser === 'alice' ? 'bob' : 'alice';
      const email = currentUser === 'alice' ? 'alice@test.com' : 'bob@test.com';
      document.getElementById('email').value = email;
      document.getElementById('switchBtn').textContent = `Switch to ${currentUser === 'alice' ? 'Bob' : 'Alice'}`;
      log(`Switched to ${currentUser}`);
    }

    async function logout() {
      if (!token) return;
      
      log('Logging out...');
      
      try {
        const res = await fetch(`${API}/auth/logout`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (res.status === 204) {
          log('‚úì Logged out successfully', 'success');
          token = null;
          updateAuthUI();
          clearTierData();
        }
      } catch (e) {
        log(`‚úó Error: ${e.message}`, 'error');
      }
    }

    async function loadTierData() {
      if (!token) return;
      
      log('Loading tier data for match #1...');
      
      try {
        const res = await fetch(`${API}/matches/1/tier`, {
          headers: { 
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/json'
          }
        });
        
        const data = await res.json();
        
        if (res.ok) {
          log(`‚úì Tier data loaded: ${data.current_tier}`, 'success');
          displayTierData(data);
          await loadPhotos(data);
        } else {
          log(`‚úó Failed to load tier: ${data.message}`, 'error');
        }
      } catch (e) {
        log(`‚úó Error: ${e.message}`, 'error');
      }
    }

    function displayTierData(data) {
      const tierInfo = document.getElementById('tierInfo');
      const { current_tier, tier_info, messages_exchanged, days_connected, has_met_in_person } = data;
      
      tierInfo.innerHTML = `
        <div class="tier-badge ${current_tier}">
          <span>${tier_info.icon}</span>
          <span>${tier_info.name}</span>
        </div>
        <p style="color: #586069; margin: 0;">
          Your relationship has progressed to the <strong>${tier_info.name}</strong> tier!
        </p>
      `;
      
      document.getElementById('metrics').innerHTML = `
        <div class="stat">
          <div class="stat-value">${messages_exchanged}</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat">
          <div class="stat-value">${Math.floor(days_connected)}</div>
          <div class="stat-label">Days</div>
        </div>
        <div class="stat">
          <div class="stat-value">${has_met_in_person ? 'Yes' : 'No'}</div>
          <div class="stat-label">Met IRL</div>
        </div>
      `;
      
      const unlocks = tier_info.unlocks || [];
      document.getElementById('unlocks').innerHTML = unlocks.map(u => `<li>${u}</li>`).join('');
    }

    async function loadPhotos(tierData) {
      if (!token) return;
      
      log('Loading photos...');
      
      try {
        const res = await fetch(`${API}/matches/1/photos`, {
          headers: { 
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/json'
          }
        });
        
        const data = await res.json();
        
        if (res.ok) {
          log(`‚úì Photos loaded: ${data.available_photos.length} visible, ${data.locked_count} locked`, 'success');
          displayPhotos(data);
        } else {
          log(`‚úó Failed to load photos: ${data.message}`, 'error');
        }
      } catch (e) {
        log(`‚úó Error: ${e.message}`, 'error');
      }
    }

    function displayPhotos(data) {
      const aiPhotos = data.available_photos.filter(p => p.photo_type === 'ai');
      const realPhotos = data.available_photos.filter(p => p.photo_type === 'real');
      
      document.getElementById('aiPhotos').innerHTML = aiPhotos.map((p, i) => `
        <div class="photo-card ai">
          <span>üé®</span>
          <span class="photo-badge ai">AI ${i + 1}</span>
        </div>
      `).join('');
      
      const realPhotoHTML = realPhotos.map((p, i) => `
        <div class="photo-card real ${p.blurred ? 'blurred' : ''}">
          <span>${p.blurred ? 'üå´Ô∏è' : 'üì∏'}</span>
          <span class="photo-badge real">Real ${i + 1}</span>
        </div>
      `).join('');
      
      const lockedCount = 5 - realPhotos.length;
      const lockedHTML = Array(lockedCount).fill(0).map((_, i) => `
        <div class="photo-card real locked">
          <span>üîí</span>
          <span class="photo-badge real">Locked</span>
        </div>
      `).join('');
      
      document.getElementById('realPhotos').innerHTML = realPhotoHTML + lockedHTML;
    }

    function clearTierData() {
      document.getElementById('tierInfo').innerHTML = '<p style="color: #586069;">Login to view tier information</p>';
      document.getElementById('metrics').innerHTML = `
        <div class="stat"><div class="stat-value">--</div><div class="stat-label">Messages</div></div>
        <div class="stat"><div class="stat-value">--</div><div class="stat-label">Days</div></div>
        <div class="stat"><div class="stat-value">--</div><div class="stat-label">Met IRL</div></div>
      `;
      document.getElementById('unlocks').innerHTML = '<li style="opacity: 0.5;">Login to see unlocks</li>';
      document.getElementById('aiPhotos').innerHTML = `
        <div class="photo-card ai locked"><span>üé®</span><span class="photo-badge ai">AI</span></div>
        <div class="photo-card ai locked"><span>üé®</span><span class="photo-badge ai">AI</span></div>
      `;
      document.getElementById('realPhotos').innerHTML = Array(5).fill(0).map(() => `
        <div class="photo-card real locked"><span>üîí</span><span class="photo-badge real">Real</span></div>
      `).join('');
    }

    // Initialize
    updateAuthUI();
    log('Demo ready! Login as Alice or Bob to see tier system in action.', 'info');
  </script>
</body>
</html>
