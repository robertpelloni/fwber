#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Commit message hook - validates commit message format
# Enforces Conventional Commits specification

echo "üìù Validating commit message..."

# Read the commit message
commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Conventional Commits pattern:
# type(scope?): subject
#
# Types: feat, fix, docs, style, refactor, perf, test, chore, build, ci, revert
# Example: feat(auth): add login functionality

pattern="^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\(.+\))?: .{1,100}"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo "‚ùå Invalid commit message format!"
  echo ""
  echo "Commit message must follow Conventional Commits specification:"
  echo ""
  echo "  type(scope?): subject"
  echo ""
  echo "Types:"
  echo "  feat:     A new feature"
  echo "  fix:      A bug fix"
  echo "  docs:     Documentation only changes"
  echo "  style:    Code style changes (formatting, semicolons, etc.)"
  echo "  refactor: Code change that neither fixes a bug nor adds a feature"
  echo "  perf:     Performance improvement"
  echo "  test:     Adding or updating tests"
  echo "  chore:    Changes to build process or auxiliary tools"
  echo "  build:    Changes to build system or dependencies"
  echo "  ci:       Changes to CI configuration"
  echo "  revert:   Revert a previous commit"
  echo ""
  echo "Examples:"
  echo "  feat: add user authentication"
  echo "  fix(api): resolve timeout issue"
  echo "  docs: update README with setup instructions"
  echo "  refactor(components): simplify button logic"
  echo ""
  echo "Your commit message:"
  echo "  $commit_msg"
  echo ""
  exit 1
fi

echo "‚úÖ Commit message is valid!"
exit 0
